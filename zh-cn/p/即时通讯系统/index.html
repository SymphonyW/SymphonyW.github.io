<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="è¿™æ˜¯ä¸€ä¸ªåŸºäºGolangçš„å³æ—¶é€šè®¯ç³»ç»Ÿ">
<title>å³æ—¶é€šè®¯ç³»ç»Ÿ</title>

<link rel='canonical' href='https://SymphonyW.github.io/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/'>

<link rel="stylesheet" href="/scss/style.min.fcb8ae9ec4ce6e601e4b352c4eb06a952a123e46064b9bae06de6961bd51fd81.css"><meta property='og:title' content="å³æ—¶é€šè®¯ç³»ç»Ÿ">
<meta property='og:description' content="è¿™æ˜¯ä¸€ä¸ªåŸºäºGolangçš„å³æ—¶é€šè®¯ç³»ç»Ÿ">
<meta property='og:url' content='https://SymphonyW.github.io/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/'>
<meta property='og:site_name' content='SymphonyW'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Golang' /><meta property='article:tag' content='Study' /><meta property='article:tag' content='Project' /><meta property='article:tag' content='IM-System' /><meta property='article:published_time' content='2026-01-21T15:10:42&#43;08:00'/><meta property='article:modified_time' content='2026-01-21T15:10:42&#43;08:00'/><meta property='og:image' content='https://SymphonyW.github.io/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/pawel-czerwinski-8uZPynIu-rQ-unsplash.jpg' />
<meta name="twitter:title" content="å³æ—¶é€šè®¯ç³»ç»Ÿ">
<meta name="twitter:description" content="è¿™æ˜¯ä¸€ä¸ªåŸºäºGolangçš„å³æ—¶é€šè®¯ç³»ç»Ÿ"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://SymphonyW.github.io/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/pawel-czerwinski-8uZPynIu-rQ-unsplash.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/zh-cn/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hua20e9d08cce84e79524a418ee5d4524c_7426_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/zh-cn">SymphonyW</a></h1>
            <h2 class="site-description">Welcome to my Blog.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/636661367?spm_id_from=333.1007.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0-beta2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92.02C65.57 463.2 43.81 454.2 26.74 436.8C9.682 419.4 .7667 396.5 0 368.2V169.8C.7667 143.8 9.682 122.2 26.74 104.1C43.81 87.75 65.57 78.77 92.02 78H121.4L96.05 52.19C90.3 46.46 87.42 39.19 87.42 30.4C87.42 21.6 90.3 14.34 96.05 8.603C101.8 2.868 109.1 0 117.9 0C126.7 0 134 2.868 139.8 8.603L213.1 78H301.1L375.6 8.603C381.7 2.868 389.2 0 398 0C406.8 0 414.1 2.868 419.9 8.603C425.6 14.34 428.5 21.6 428.5 30.4C428.5 39.19 425.6 46.46 419.9 52.19L394.6 78L423.9 78C450.3 78.77 471.9 87.75 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.05C86.46 140.9 78.6 144.2 72.47 150.3C66.33 156.4 63.07 164.2 62.69 173.8V368.2C62.69 377.4 65.95 385.2 72.47 391.7C78.99 398.2 86.85 401.5 96.05 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/SymphonyW'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/zh-cn/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://SymphonyW.github.io/" >English</option>
                                
                                    <option value="https://SymphonyW.github.io/zh-cn/" selected>ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</a></li>
    <li><a href="#v01-åŸºç¡€serveræ„å»º">v0.1 åŸºç¡€serveræ„å»º</a>
      <ol>
        <li><a href="#servergo">server.go</a></li>
        <li><a href="#maingo">main.go</a></li>
      </ol>
    </li>
    <li><a href="#v02-ç”¨æˆ·ä¸Šçº¿åŠå¹¿æ’­åŠŸèƒ½">v0.2 ç”¨æˆ·ä¸Šçº¿åŠå¹¿æ’­åŠŸèƒ½</a>
      <ol>
        <li><a href="#usergoæ–°å¢">user.go(æ–°å¢)</a>
          <ol>
            <li><a href="#userç±»å‹">userç±»å‹</a></li>
            <li><a href="#æ–¹æ³•">æ–¹æ³•</a></li>
            <li><a href="#ç›‘å¬å½“å‰userçš„channelçš„æ–¹æ³•ä¸€æ—¦æœ‰æ¶ˆæ¯å°±å‘é€ç»™å¯¹ç«¯å®¢æˆ·ç«¯">ç›‘å¬å½“å‰Userçš„channelçš„æ–¹æ³•ï¼Œä¸€æ—¦æœ‰æ¶ˆæ¯ï¼Œå°±å‘é€ç»™å¯¹ç«¯å®¢æˆ·ç«¯</a></li>
          </ol>
        </li>
        <li><a href="#servergo-1">server.go</a>
          <ol>
            <li><a href="#serverç±»å‹æ–°å¢onlinemapå’Œmessageå±æ€§">serverç±»å‹ï¼šæ–°å¢OnlineMapå’ŒMessageå±æ€§</a></li>
            <li><a href="#ä¿®æ”¹handleræ–¹æ³•">ä¿®æ”¹Handleræ–¹æ³•</a></li>
            <li><a href="#æ–°å¢å¹¿æ’­æ¶ˆæ¯æ–¹æ³•">æ–°å¢å¹¿æ’­æ¶ˆæ¯æ–¹æ³•</a></li>
            <li><a href="#æ–°å¢ç›‘å¬å¹¿æ’­æ¶ˆæ¯channelæ–¹æ³•">æ–°å¢ç›‘å¬å¹¿æ’­æ¶ˆæ¯channelæ–¹æ³•</a></li>
            <li><a href="#ä¿®æ”¹startæ–¹æ³•">ä¿®æ”¹Startæ–¹æ³•</a></li>
          </ol>
        </li>
        <li><a href="#æµ‹è¯•">æµ‹è¯•</a></li>
      </ol>
    </li>
    <li><a href="#v03-ç”¨æˆ·æ¶ˆæ¯å¹¿æ’­åŠŸèƒ½">v0.3 ç”¨æˆ·æ¶ˆæ¯å¹¿æ’­åŠŸèƒ½</a></li>
    <li><a href="#v04-ç”¨æˆ·ä¸šåŠ¡å°è£…">v0.4 ç”¨æˆ·ä¸šåŠ¡å°è£…</a>
      <ol>
        <li><a href="#userç±»æ·»åŠ æ–°æˆå‘˜å˜é‡server">userç±»æ·»åŠ æ–°æˆå‘˜å˜é‡server</a></li>
        <li><a href="#æ–°å¢onlineæ–¹æ³•">æ–°å¢Onlineæ–¹æ³•</a></li>
        <li><a href="#æ–°å¢offlineæ–¹æ³•">æ–°å¢Offlineæ–¹æ³•</a></li>
        <li><a href="#æ–°å¢domessageæ–¹æ³•">æ–°å¢DoMessageæ–¹æ³•</a></li>
        <li><a href="#æ›¿æ¢">æ›¿æ¢</a></li>
      </ol>
    </li>
    <li><a href="#v05-åœ¨çº¿ç”¨æˆ·æŸ¥è¯¢">v0.5 åœ¨çº¿ç”¨æˆ·æŸ¥è¯¢</a>
      <ol>
        <li><a href="#æä¾›sendmsgå‘å¯¹è±¡å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯api">æä¾›SendMsgå‘å¯¹è±¡å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯API</a></li>
        <li><a href="#åœ¨domessageæ–¹æ³•ä¸­åŠ ä¸Šå¯¹whoæŒ‡ä»¤çš„å¤„ç†">åœ¨DoMessageæ–¹æ³•ä¸­ï¼ŒåŠ ä¸Šå¯¹â€œwhoâ€æŒ‡ä»¤çš„å¤„ç†</a></li>
        <li><a href="#ä¸€ä¸ªå°bug">ä¸€ä¸ªå°bug</a></li>
        <li><a href="#æµ‹è¯•-1">æµ‹è¯•</a></li>
      </ol>
    </li>
    <li><a href="#v06-ä¿®æ”¹ç”¨æˆ·å">v0.6 ä¿®æ”¹ç”¨æˆ·å</a>
      <ol>
        <li><a href="#ä¿®æ”¹ä»£ç ">ä¿®æ”¹ä»£ç </a></li>
        <li><a href="#æµ‹è¯•-2">æµ‹è¯•</a></li>
      </ol>
    </li>
    <li><a href="#v07-è¶…æ—¶å¼ºè¸¢åŠŸèƒ½">v0.7 è¶…æ—¶å¼ºè¸¢åŠŸèƒ½</a>
      <ol>
        <li><a href="#ä¿®æ”¹handleræ–¹æ³•-1">ä¿®æ”¹Handleræ–¹æ³•</a></li>
        <li><a href="#æµ‹è¯•-3">æµ‹è¯•</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/">
                <img src="/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/pawel-czerwinski-8uZPynIu-rQ-unsplash_hud7e36f7e20e71be184458283bdae4646_55974_800x0_resize_q75_box.jpg"
                        srcset="/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/pawel-czerwinski-8uZPynIu-rQ-unsplash_hud7e36f7e20e71be184458283bdae4646_55974_800x0_resize_q75_box.jpg 800w, /zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/pawel-czerwinski-8uZPynIu-rQ-unsplash_hud7e36f7e20e71be184458283bdae4646_55974_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="534" 
                        loading="lazy"
                        alt="Featured image of post å³æ—¶é€šè®¯ç³»ç»Ÿ" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/zh-cn/p/%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E7%B3%BB%E7%BB%9F/">å³æ—¶é€šè®¯ç³»ç»Ÿ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            è¿™æ˜¯ä¸€ä¸ªåŸºäºGolangçš„å³æ—¶é€šè®¯ç³»ç»Ÿ
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2026-01-21 15:10</time>
            </div>
        

        
    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://SymphonyW.github.io/p/instant-messaging-system/" class="link">English</a>
                
            </div>
        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="å³æ—¶é€šè®¯ç³»ç»Ÿ">å³æ—¶é€šè®¯ç³»ç»Ÿ
</h1><h2 id="ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„
</h2><p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.1-system-frame.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.1-system-frame.png" 
             alt="ç³»ç»Ÿæ¶æ„å›¾" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">ç³»ç»Ÿæ¶æ„å›¾</span>
    
</div></p>
<h2 id="v01-åŸºç¡€serveræ„å»º">v0.1 åŸºç¡€serveræ„å»º
</h2><p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.1.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.1.png" 
             alt="v0.1 æ„å»ºåŸºç¡€Server" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">v0.1 æ„å»ºåŸºç¡€Server</span>
    
</div></p>
<p>æ­¤ç‰ˆæœ¬åªæœ‰å¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<h3 id="servergo">server.go
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Ip</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºä¸€ä¸ªserverçš„æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewServer</span><span class="p">(</span><span class="nx">ip</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">port</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Server</span><span class="p">{</span><span class="nx">ip</span><span class="p">,</span> <span class="nx">port</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">server</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...å½“å‰é“¾æ¥çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;é“¾æ¥å»ºç«‹æˆåŠŸ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¯åŠ¨æœåŠ¡å™¨çš„æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">Start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// socket listenï¼Œnet.Listenç”¨äºåˆ›å»ºå¥—æ¥å­—ï¼Œå‚æ•°ä¸º(network, address string)ï¼Œè¿”å›å€¼ä¸º(Listener, error)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">listener</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s:%d&#34;</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Ip</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Port</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;net.Listen err:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// close listen socket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;å…³é—­é“¾æ¥&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">listener</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// acceptï¼Œä¼šè¿”å›ä¸€ä¸ªè¿æ¥Connï¼Œå’Œerr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">listener</span><span class="p">.</span><span class="nf">Accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;listener.Accept err:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">continue</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// do handler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">go</span> <span class="nx">this</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="maingo">main.go
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="nf">NewServer</span><span class="p">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span><span class="p">.</span><span class="nf">Start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘è¿è¡Œï¼š</p>
<ul>
<li>Linuxç³»ç»Ÿï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">go build -o server main.go server.go
</span></span><span class="line"><span class="cl">server
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Windowsç³»ç»Ÿ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">go build -o server.exe main.go server.go
</span></span><span class="line"><span class="cl">.\server.exe
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åè¿è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œæ ¹æ®ç³»ç»Ÿè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤è¿›è¡Œæµ‹è¯•ï¼š</p>
<ul>
<li>Linuxç³»ç»Ÿå¯ä»¥æ‰§è¡Œnc 127.0.0.1 8888</li>
<li>Windowsç³»ç»Ÿå¯ä»¥æ‰§è¡Œcurl 127.0.0.1:8888</li>
</ul>
<p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.1-test.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.1-test.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div>
è‹¥å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼Œåˆ™è¡¨ç¤ºæ„å»ºæˆåŠŸã€‚
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.1-test-output.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.1-test-output.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div></p>
<h2 id="v02-ç”¨æˆ·ä¸Šçº¿åŠå¹¿æ’­åŠŸèƒ½">v0.2 ç”¨æˆ·ä¸Šçº¿åŠå¹¿æ’­åŠŸèƒ½
</h2><p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.2-system-frame.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.2-system-frame.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div></p>
<h3 id="usergoæ–°å¢">user.go(æ–°å¢)
</h3><h4 id="userç±»å‹">userç±»å‹
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Addr</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">C</span>    <span class="kd">chan</span> <span class="kt">string</span> <span class="c1">// ä¸ç”¨æˆ·é€šä¿¡çš„ç®¡é“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span>    <span class="c1">// ç”¨æˆ·çš„ç½‘ç»œè¿æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ–¹æ³•">æ–¹æ³•
</h4><h5 id="åˆ›å»ºä¸€ä¸ªç”¨æˆ·çš„api">åˆ›å»ºä¸€ä¸ªç”¨æˆ·çš„API
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewUser</span><span class="p">(</span><span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="o">*</span><span class="nx">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">userAddr</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">RemoteAddr</span><span class="p">().</span><span class="nf">String</span><span class="p">()</span> <span class="c1">// è·å–ç”¨æˆ·çš„ç½‘ç»œåœ°å€å¹¶è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œä½œä¸ºç”¨æˆ·å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">user</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Name</span><span class="p">:</span> <span class="nx">userAddr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Addr</span><span class="p">:</span> <span class="nx">userAddr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">C</span><span class="p">:</span>    <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">),</span> <span class="c1">// åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯ç®¡é“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">conn</span><span class="p">:</span> <span class="nx">conn</span><span class="p">,</span>              <span class="c1">// ä¿å­˜ç”¨æˆ·çš„ç½‘ç»œè¿æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ›å»ºå®Œç”¨æˆ·å¯¹è±¡åï¼Œå°±å¯åŠ¨ç›‘å¬å½“å‰ User çš„æ¶ˆæ¯ç®¡é“çš„ goroutine
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">go</span> <span class="nx">user</span><span class="p">.</span><span class="nf">ListenMessage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç›‘å¬å½“å‰userçš„channelçš„æ–¹æ³•ä¸€æ—¦æœ‰æ¶ˆæ¯å°±å‘é€ç»™å¯¹ç«¯å®¢æˆ·ç«¯">ç›‘å¬å½“å‰Userçš„channelçš„æ–¹æ³•ï¼Œä¸€æ—¦æœ‰æ¶ˆæ¯ï¼Œå°±å‘é€ç»™å¯¹ç«¯å®¢æˆ·ç«¯
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">ListenMessage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">			ä» channel C æ¥æ”¶æ¶ˆæ¯å­—ç¬¦ä¸² msg
</span></span></span><span class="line"><span class="cl"><span class="cm">			åœ¨æ¶ˆæ¯æœ«å°¾åŠ æ¢è¡Œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="cm">			è½¬æ¢ä¸ºå­—èŠ‚åˆ‡ç‰‡
</span></span></span><span class="line"><span class="cl"><span class="cm">			é€šè¿‡ç½‘ç»œè¿æ¥å‘é€ç»™å®¢æˆ·ç«¯
</span></span></span><span class="line"><span class="cl"><span class="cm">		*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">this</span><span class="p">.</span><span class="nx">C</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">this</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">msg</span> <span class="o">+</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span> <span class="c1">// å°†æ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚åˆ‡ç‰‡ï¼ˆå› ä¸º Write() æ–¹æ³•éœ€è¦æ¥æ”¶å­—èŠ‚åˆ‡ç‰‡ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="servergo-1">server.go
</h3><h4 id="serverç±»å‹æ–°å¢onlinemapå’Œmessageå±æ€§">serverç±»å‹ï¼šæ–°å¢OnlineMapå’ŒMessageå±æ€§
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Ip</span>   <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Port</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">OnlineMap</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">User</span> <span class="c1">// map[key]valueï¼Œkeyæ˜¯ç”¨æˆ·åï¼Œvalueæ˜¯Userå¯¹è±¡æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">mapLock</span>   <span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>     <span class="c1">// ä¿æŠ¤åœ¨çº¿ç”¨æˆ·åˆ—è¡¨çš„é”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¶ˆæ¯å¹¿æ’­çš„channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Message</span> <span class="kd">chan</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºä¸€ä¸ªserverçš„æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">NewServer</span><span class="p">(</span><span class="nx">ip</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">port</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Server</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Ip</span><span class="p">:</span>        <span class="nx">ip</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Port</span><span class="p">:</span>      <span class="nx">port</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">OnlineMap</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">User</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Message</span><span class="p">:</span>   <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">server</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¿®æ”¹handleræ–¹æ³•">ä¿®æ”¹Handleræ–¹æ³•
</h4><p><strong>åœ¨å¤„ç†å®¢æˆ·ç«¯ä¸Šçº¿çš„Handleråˆ›å»ºå¹¶æ·»åŠ â½¤ç”¨æˆ·</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...å½“å‰é“¾æ¥çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;é“¾æ¥å»ºç«‹æˆåŠŸï¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">user</span> <span class="o">:=</span> <span class="nf">NewUser</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”¨æˆ·ä¸Šçº¿ï¼Œå°†ç”¨æˆ·åŠ å…¥åˆ°OnlineMapä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å¹¿æ’­å½“å‰ç”¨æˆ·ä¸Šçº¿æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;å·²ä¸Šçº¿\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å½“å‰handleré˜»å¡ï¼šè‹¥å½“å‰handlerç»“æŸï¼Œåˆ™æ‰€æœ‰å­goç¨‹ä¹Ÿéƒ½ä¼šç»“æŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">select</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ–°å¢å¹¿æ’­æ¶ˆæ¯æ–¹æ³•">æ–°å¢å¹¿æ’­æ¶ˆæ¯æ–¹æ³•
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// å¹¿æ’­æ¶ˆæ¯çš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">BroadCast</span><span class="p">(</span><span class="nx">user</span> <span class="o">*</span><span class="nx">User</span><span class="p">,</span> <span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sendMsg</span> <span class="o">:=</span> <span class="s">&#34;[&#34;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Addr</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Name</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="nx">msg</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">Message</span> <span class="o">&lt;-</span> <span class="nx">sendMsg</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ–°å¢ç›‘å¬å¹¿æ’­æ¶ˆæ¯channelæ–¹æ³•">æ–°å¢ç›‘å¬å¹¿æ’­æ¶ˆæ¯channelæ–¹æ³•
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç›‘å¬Messageå¹¿æ’­æ¶ˆæ¯channelçš„goroutineï¼Œä¸€æ—¦æœ‰æ¶ˆæ¯å°±å‘é€ç»™å…¨éƒ¨çš„åœ¨çº¿User
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">ListenMessager</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">this</span><span class="p">.</span><span class="nx">Message</span> <span class="c1">// ä¸æ–­åœ°ä»this.Messageä¸­è¯»æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å°†msgå‘é€ç»™å…¨éƒ¨çš„åœ¨çº¿User
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">this</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">cli</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">this</span><span class="p">.</span><span class="nx">OnlineMap</span> <span class="p">{</span> <span class="c1">// key:_  value:cli
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">cli</span><span class="p">.</span><span class="nx">C</span> <span class="o">&lt;-</span> <span class="nx">msg</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">this</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¿®æ”¹startæ–¹æ³•">ä¿®æ”¹Startæ–¹æ³•
</h4><p><strong>ç”¨ä¸€ä¸ªgoroutineå•ç‹¬ç›‘å¬Message</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// å¯åŠ¨æœåŠ¡å™¨çš„æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">Start</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// socket listenï¼Œnet.Listenç”¨äºåˆ›å»ºå¥—æ¥å­—ï¼Œå‚æ•°ä¸º(network, address string)ï¼Œè¿”å›å€¼ä¸º(Listener, error)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">listener</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s:%d&#34;</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Ip</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Port</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;net.Listen err:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// close listen socket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;å…³é—­è¿æ¥&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">listener</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//--------------åœ¨æ­¤ä¿®æ”¹--------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å¯åŠ¨ç›‘å¬Messageçš„goroutine
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">go</span> <span class="nx">this</span><span class="p">.</span><span class="nf">ListenMessager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// acceptï¼Œä¼šè¿”å›ä¸€ä¸ªè¿æ¥Connï¼Œå’Œerr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">listener</span><span class="p">.</span><span class="nf">Accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;listener.Accept err:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">continue</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// do handler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">go</span> <span class="nx">this</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æµ‹è¯•">æµ‹è¯•
</h3><p><strong>æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥å®ç°ç”¨æˆ·ä¸Šçº¿æ¶ˆæ¯çš„å¹¿æ’­ã€‚</strong>
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.2-test.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.2-test.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div></p>
<h2 id="v03-ç”¨æˆ·æ¶ˆæ¯å¹¿æ’­åŠŸèƒ½">v0.3 ç”¨æˆ·æ¶ˆæ¯å¹¿æ’­åŠŸèƒ½
</h2><p><strong>æ­¤ç‰ˆæœ¬åªéœ€å®Œå–„server.goä¸­çš„handleræ–¹æ³•å³å¯ã€‚</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...å½“å‰é“¾æ¥çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;é“¾æ¥å»ºç«‹æˆåŠŸï¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">user</span> <span class="o">:=</span> <span class="nf">NewUser</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”¨æˆ·ä¸Šçº¿ï¼Œå°†ç”¨æˆ·åŠ å…¥åˆ°OnlineMapä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">user</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å¹¿æ’­å½“å‰ç”¨æˆ·ä¸Šçº¿æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;ä¸Šçº¿äº†\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//--------------æ–°å¢éƒ¨åˆ†--------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼šå¯¹socketè¿›è¡ŒåŸºæœ¬çš„readæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="c1">// ä»å½“å‰connå¥—æ¥å­—ä¸­è¯»å–æ•°æ®åˆ°bufä¸­ï¼Œè¿”å›å€¼æ˜¯è¯»å–çš„å­—èŠ‚æ•°nå’Œé”™è¯¯ä¿¡æ¯err
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">this</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="s">&#34;ä¸‹çº¿äº†\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Conn Read err:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// æå–ç”¨æˆ·çš„æ¶ˆæ¯å¹¶å»é™¤ç»“å°¾çš„&#39;\n&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">msg</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// å°†å¾—åˆ°çš„æ¶ˆæ¯è¿›è¡Œå¹¿æ’­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">this</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//---------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å½“å‰handleré˜»å¡ï¼šè‹¥å½“å‰handlerç»“æŸï¼Œåˆ™æ‰€æœ‰å­goç¨‹ä¹Ÿéƒ½ä¼šç»“æŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">select</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æµ‹è¯•</strong>
<strong>æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥å®ç°å¹¿æ’­ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä»¥åŠç”¨æˆ·ä¸‹çº¿æ¶ˆæ¯ã€‚</strong>
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.3-test.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.3-test.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div></p>
<h2 id="v04-ç”¨æˆ·ä¸šåŠ¡å°è£…">v0.4 ç”¨æˆ·ä¸šåŠ¡å°è£…
</h2><p><strong>ä¸v0.3çš„åŠŸèƒ½ç›¸åŒï¼Œä¸»è¦æ˜¯å°†ç”¨æˆ·ä¸Šçº¿ä¸‹çº¿ä»¥åŠå‘é€æ¶ˆæ¯çš„æ–¹æ³•å°è£…åˆ°user.goä¸­ã€‚</strong></p>
<h3 id="userç±»æ·»åŠ æ–°æˆå‘˜å˜é‡server">userç±»æ·»åŠ æ–°æˆå‘˜å˜é‡server
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Addr</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">C</span>    <span class="kd">chan</span> <span class="kt">string</span> <span class="c1">// ä¸ç”¨æˆ·é€šä¿¡çš„ç®¡é“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span>    <span class="c1">// ç”¨æˆ·çš„ç½‘ç»œè¿æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nx">server</span> <span class="o">*</span><span class="nx">Server</span>   <span class="c1">// æ‰€å±æœåŠ¡å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–°å¢onlineæ–¹æ³•">æ–°å¢Onlineæ–¹æ³•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·ä¸Šçº¿çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">Online</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”¨æˆ·ä¸Šçº¿ï¼Œå°†ç”¨æˆ·åŠ å…¥åˆ°OnlineMapä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">[</span><span class="nx">this</span><span class="p">.</span><span class="nx">Name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">this</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å¹¿æ’­å½“å‰ç”¨æˆ·ä¸Šçº¿æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">this</span><span class="p">,</span> <span class="s">&#34;ä¸Šçº¿äº†\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–°å¢offlineæ–¹æ³•">æ–°å¢Offlineæ–¹æ³•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·ä¸‹çº¿çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">Offline</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”¨æˆ·ä¸‹çº¿ï¼Œå°†ç”¨æˆ·ä»OnlineMapä¸­åˆ é™¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nb">delete</span><span class="p">(</span><span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å¹¿æ’­å½“å‰ç”¨æˆ·ä¸‹çº¿æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">this</span><span class="p">,</span> <span class="s">&#34;ä¸‹çº¿äº†\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–°å¢domessageæ–¹æ³•">æ–°å¢DoMessageæ–¹æ³•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">DoMessage</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">this</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ›¿æ¢">æ›¿æ¢
</h3><p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.4-replaced.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.4-replaced.png" 
             alt="éœ€è¦æ›¿æ¢çš„éƒ¨åˆ†" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">éœ€è¦æ›¿æ¢çš„éƒ¨åˆ†</span>
    
</div></p>
<h2 id="v05-åœ¨çº¿ç”¨æˆ·æŸ¥è¯¢">v0.5 åœ¨çº¿ç”¨æˆ·æŸ¥è¯¢
</h2><h3 id="æä¾›sendmsgå‘å¯¹è±¡å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯api">æä¾›SendMsgå‘å¯¹è±¡å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯API
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç»™å½“å‰userå¯¹åº”çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">SendMsg</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">this</span><span class="p">.</span><span class="nx">conn</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">msg</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åœ¨domessageæ–¹æ³•ä¸­åŠ ä¸Šå¯¹whoæŒ‡ä»¤çš„å¤„ç†">åœ¨DoMessageæ–¹æ³•ä¸­ï¼ŒåŠ ä¸Šå¯¹â€œwhoâ€æŒ‡ä»¤çš„å¤„ç†
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">DoMessage</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">msg</span> <span class="o">==</span> <span class="s">&#34;who&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æŸ¥è¯¢å½“å‰åœ¨çº¿ç”¨æˆ·éƒ½æœ‰å“ªäº›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">user</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">onlineMesg</span> <span class="o">:=</span> <span class="s">&#34;[&#34;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Addr</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Name</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="s">&#34;åœ¨çº¿\n&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">onlineMesg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">this</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¸€ä¸ªå°bug">ä¸€ä¸ªå°bug
</h3><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‰é¢å¯¹ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯ä»…å»æ‰äº†æœ€æœ«å°¾çš„&rsquo;\n&rsquo;ï¼Œä½†è¿™æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºWindowsä¸‹é»˜è®¤çš„æ¢è¡Œæ ‡è¯†ç¬¦æ˜¯&rsquo;\r\n&rsquo;ï¼Œå› æ­¤éœ€è¦å»æ‰æœ«å°¾çš„ä¸¤ä¸ªå…ƒç´ ã€‚</strong>
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.5-bug-1.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.5-bug-1.png" 
             alt="å…·ä½“ä¿®æ”¹ä½ç½®" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">å…·ä½“ä¿®æ”¹ä½ç½®</span>
    
</div></p>
<p><strong>å¦å¤–ï¼Œä¸åŒæ“ä½œç³»ç»Ÿçš„é»˜è®¤æ¢è¡Œæ ‡è¯†ç¬¦ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œè‹¥ä¸‹å›¾æ‰€ç¤ºï¼š</strong>
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.5-default-sign.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.5-default-sign.png" 
             alt="ä¸åŒæ“ä½œç³»ç»Ÿä¸‹çš„é»˜è®¤æ¢è¡Œæ ‡è¯†ç¬¦" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">ä¸åŒæ“ä½œç³»ç»Ÿä¸‹çš„é»˜è®¤æ¢è¡Œæ ‡è¯†ç¬¦</span>
    
</div></p>
<h3 id="æµ‹è¯•-1">æµ‹è¯•
</h3><p>**ç”¨æˆ·è¾“å…¥&quot;who&quot;å³å¯æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·ã€‚å¦‚æ­¤ï¼Œå³å¯å®ç°æŸ¥è¯¢åœ¨çº¿ç”¨æˆ·çš„æ“ä½œ
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.5-test.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.5-test.png" 
             alt="æŸ¥è¯¢ç¤ºä¾‹" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">æŸ¥è¯¢ç¤ºä¾‹</span>
    
</div></p>
<h2 id="v06-ä¿®æ”¹ç”¨æˆ·å">v0.6 ä¿®æ”¹ç”¨æˆ·å
</h2><h3 id="ä¿®æ”¹ä»£ç ">ä¿®æ”¹ä»£ç 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">User</span><span class="p">)</span> <span class="nf">DoMessage</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">msg</span> <span class="o">==</span> <span class="s">&#34;who&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æŸ¥è¯¢å½“å‰åœ¨çº¿ç”¨æˆ·éƒ½æœ‰å“ªäº›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">user</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">onlineMesg</span> <span class="o">:=</span> <span class="s">&#34;[&#34;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Addr</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">Name</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="s">&#34;åœ¨çº¿\n&#34;</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="nx">onlineMesg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">7</span> <span class="o">&amp;&amp;</span> <span class="nx">msg</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#34;rename|&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ¶ˆæ¯æ ¼å¼ï¼šrename|å¼ ä¸‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">// string.Split(msg, &#34;sign&#34;)å¯ä»¥å°†å­—ç¬¦ä¸²msgä»¥signä¸ºæ–­ç‚¹æ¥åˆ‡åˆ†ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">newName</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="s">&#34;|&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// åˆ¤æ–­nameæ˜¯å¦å­˜åœ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">[</span><span class="nx">newName</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="s">&#34;å½“å‰ç”¨æˆ·åå·²è¢«ä½¿ç”¨!\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="nb">delete</span><span class="p">(</span><span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">OnlineMap</span><span class="p">[</span><span class="nx">newName</span><span class="p">]</span> <span class="p">=</span> <span class="nx">this</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">mapLock</span><span class="p">.</span><span class="nf">Unlock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="nx">newName</span>
</span></span><span class="line"><span class="cl">			<span class="nx">this</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="s">&#34;æ‚¨å·²æˆåŠŸæ›´æ–°ç”¨æˆ·å:&#34;</span> <span class="o">+</span> <span class="nx">this</span><span class="p">.</span><span class="nx">Name</span> <span class="o">+</span> <span class="s">&#34;!\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nf">BroadCast</span><span class="p">(</span><span class="nx">this</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.6-modified.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.6-modified.png" 
             alt="åœ¨æ­¤å¤„è¿›è¡Œä¿®æ”¹" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
        <span style="display: block; margin-top: 10px; color: #666; font-size: 0.9em;">åœ¨æ­¤å¤„è¿›è¡Œä¿®æ”¹</span>
    
</div></p>
<h3 id="æµ‹è¯•-2">æµ‹è¯•
</h3><p><strong>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼ŒæˆåŠŸå®ç°ä¿®æ”¹ç”¨æˆ·ååŠOnline Mapæ“ä½œï¼š</strong>
<div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.6-test.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.6-test.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div></p>
<h2 id="v07-è¶…æ—¶å¼ºè¸¢åŠŸèƒ½">v0.7 è¶…æ—¶å¼ºè¸¢åŠŸèƒ½
</h2><h3 id="ä¿®æ”¹handleræ–¹æ³•-1">ä¿®æ”¹Handleræ–¹æ³•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">Handler</span><span class="p">(</span><span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...å½“å‰é“¾æ¥çš„ä¸šåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;é“¾æ¥å»ºç«‹æˆåŠŸï¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">user</span> <span class="o">:=</span> <span class="nf">NewUser</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span> <span class="nx">this</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">user</span><span class="p">.</span><span class="nf">Online</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// -----------ä¿®æ”¹ä½ç½®-----------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ç›‘å¬ç”¨æˆ·æ˜¯å¦æ´»è·ƒçš„channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">isLive</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// -----------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼šå¯¹socketè¿›è¡ŒåŸºæœ¬çš„readæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// ä»å½“å‰connå¥—æ¥å­—ä¸­è¯»å–æ•°æ®åˆ°bufä¸­ï¼Œè¿”å›å€¼æ˜¯è¯»å–çš„å­—èŠ‚æ•°nå’Œé”™è¯¯ä¿¡æ¯err
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">user</span><span class="p">.</span><span class="nf">Offline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Conn Read err:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// æå–ç”¨æˆ·çš„æ¶ˆæ¯å¹¶å»é™¤ç»“å°¾çš„&#39;\r\n&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">msg</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[:</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// ç”¨æˆ·é’ˆå¯¹msgè¿›è¡Œæ¶ˆæ¯å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">user</span><span class="p">.</span><span class="nf">DoMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// ç”¨æˆ·çš„ä»»æ„æ¶ˆæ¯ï¼Œéƒ½èƒ½ä»£è¡¨ç”¨æˆ·å½“å‰æ˜¯æ´»è·ƒçš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">isLive</span> <span class="o">&lt;-</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// -----------ä¿®æ”¹ä½ç½®-----------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å½“å‰handleré˜»å¡ï¼šè‹¥å½“å‰handlerç»“æŸï¼Œåˆ™æ‰€æœ‰å­goç¨‹ä¹Ÿéƒ½ä¼šç»“æŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">select</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">isLive</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å½“å‰ç”¨æˆ·æ˜¯æ´»è·ƒçš„ï¼Œåº”è¯¥å……å€¼å®šæ—¶å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// ä¸ç”¨åšä»»ä½•äº‹æƒ…ï¼Œåªæ˜¯ä¸ºäº†ç»“æŸæœ¬æ¬¡çš„selectï¼Œå¾ªç¯è¿›å…¥æ–°çš„ä¸€ä¸ªselectï¼Œä»¥é‡ç½®ä¸‹é¢çš„å®šæ—¶å™¨ï¼Œå¦™å¦™å¦™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nf">After</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span> <span class="o">*</span> <span class="mi">30</span><span class="p">):</span> <span class="c1">// time.Afterä¹Ÿæ˜¯ä¸€ä¸ªchannelï¼Œä½œä¸ºè®¡æ—¶å™¨ä½¿ç”¨ï¼Œè¿™é‡Œè®¡æ—¶30åˆ†é’Ÿï¼Œè¶…æ—¶åchannelä¸­å°±ä¼šæœ‰ä¸€ä¸ªæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// å·²ç»è¶…æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// å°†å½“å‰çš„userå¼ºåˆ¶å…³é—­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="nx">user</span><span class="p">.</span><span class="nf">SendMsg</span><span class="p">(</span><span class="s">&#34;ç”±äºé•¿æ—¶é—´æœªæ“ä½œï¼Œä½ è¢«è¸¢äº†ã€‚\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// é”€æ¯ç”¨æˆ·èµ„æº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nb">close</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">C</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// å…³é—­è¿æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// é€€å‡ºå½“å‰handler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// runtime.Goexit()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// -----------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>selectåœ¨è¿™ä¸ªåœ°æ–¹èµ·åˆ°äº†éå¸¸å¦™çš„æ•ˆæœï¼Œå…·ä½“è¯¦è§æ³¨é‡Šã€‚</strong></p>
<h3 id="æµ‹è¯•-3">æµ‹è¯•
</h3><p><div class="post-image-container" style="margin: 15px auto; text-align: center; width: 85%;">
    
    <a href="v0.7-test.png" 
        
       target="_blank" 
       class="gallery-item"> <img src="v0.7-test.png" 
             alt="" 
             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
             
    </a>
    
</div></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/zh-cn/tags/golang/">Golang</a>
        
            <a href="/zh-cn/tags/study/">Study</a>
        
            <a href="/zh-cn/tags/project/">Project</a>
        
            <a href="/zh-cn/tags/im-system/">IM-System</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/zh-cn/p/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        
        
            <div class="article-image">
                <img src="/zh-cn/p/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/_hud7e36f7e20e71be184458283bdae4646_55974_23a5d351d2fc2374f952239b6e9c423a.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Golangå­¦ä¹ ç¬”è®°"
                        
                        data-hash="md5-xRTZFpFxc6SKQuARS0aZYQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Golangå­¦ä¹ ç¬”è®°</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2026 SymphonyW
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
